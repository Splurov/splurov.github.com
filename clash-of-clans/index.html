<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta property="fb:admins" content="splurov"/>
    <meta name="keywords" content="clash of clans, army calculator, troops calculator, army price, troops price"/>
    <title>Clash of Clans — Troops Cost Calculator</title>
    <style>@font-face{font-family:'PT Serif';src:url('/fonts/PTF55F_W.woff') format('woff')}@font-face{font-family:'PT Serif Caption';src:url('/fonts/PTZ55F_W.woff') format('woff')}html,body{background:#fefefe;color:#222}body{font-family:'PT Serif',Georgia,serif;font-size:18px;line-height:1.5;margin:0;padding:20px 40px}a{white-space:nowrap}a:link{color:#4100f1;text-decoration:none}a:visited{color:#63008c;text-decoration:none}a:hover,a:active{text-decoration:underline}h1{font-size:28px;font-family:'PT Serif Caption',Georgia,sans-serif;font-weight:normal;margin:0 0 12px}h2{font-size:22px;font-family:'PT Serif Caption',Georgia,sans-serif;font-weight:normal;margin:18px 0 4px}p{margin:0 0 12px}.content{min-width:260px;max-width:520px}.photo{margin:8px 0 20px 20px;float:right;border-radius:10px}@media all and (max-width:560px){.photo{float:none;display:block;margin:0 auto 20px}}a.fn.url{color:#222;text-decoration:none}.footer{margin-top:30px;font-size:14px;color:#ccc}.footer a:link{text-decoration:underline;color:#ccc}.footer a:visited{text-decoration:underline;color:#ccc}.footer a:hover,.footer a:active{text-decoration:none}.hidden{display:none}</style>
    <style>input,select{font-family:'PT Serif',Georgia,serif;font-size:inherit}.units{border-spacing:0;margin-bottom:12px}.units th{text-align:left;padding:2px 24px 3px 0;font-weight:normal;font-size:22px}.units td{padding:2px 24px 3px 0}.units td>input{text-align:right}.units_result{border-top:2px solid #ccc;border-bottom:2px solid #ccc}.number{text-align:right}.changelog{border-spacing:0;margin-bottom:12px;font-size:14px}.changelog td{padding:2px 24px 3px 0;vertical-align:top}.cost-elixir{background:url(/clash-of-clans/i/elixir.png) no-repeat 100% 50%;padding-right:28px}</style>
    <script>navigator.appName=="Microsoft Internet Explorer"&&(function(b,e,c,a){b.src="/clash-of-clans/i/favicon.ico";c=e.getElementsByTagName("script")[0];a=c.parentNode.insertBefore(e.createElement("link"),c);a.rel="shortcut icon";a.href=b.src})(new Image,document);</script>
    <link rel="icon" href="/clash-of-clans/i/favicon.png"/>
    <script type="text/javascript">

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-37991363-1']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script>
</head>
<body>

<form class="js-calculator">

    <h1>Clash of Clans — Troops Cost Calculator</h1>

    <table class="js-units units">
        <tr>
            <th>Unit</th>
            <th>Level</th>
            <th><span class="cost-elixir">Cost</span></th>
            <th>Quantity</th>
            <th><span class="cost-elixir">Total Cost</span></th>
        </tr>
    </table>

    <p>
        <label for="barracks">Number of Barracks</label>
        <select id="barracks" class="js-barracks" onchange="calculate()">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
    </p>

    <table class="js-result units units_result">
    </table>

</form>

<script>(function(){

    var data = {
            'Barbarian': [1, 20, [25, 40, 60, 80, 100, 150]],
            'Archer': [1, 25, [50, 80, 120, 160, 200, 300]],
            'Goblin': [1, 30, [25, 40, 60, 80, 100]],
            'Giant': [5, 120, [500, 1000, 1500, 2000, 2500, 3000]],
            'Wall_Breaker': [1, 120, [1000, 1500, 2000, 2500, 3000]],
            'Balloon': [5, 600, [2000, 2500, 3000, 3500, 4000, 4500]],
            'Wizard': [4, 600, [1500, 2000, 2500, 3000, 3500]],
            'Healer': [20, 1200, [7000, 10000, 13000]],
            'Dragon': [20, 1800, [25000, 32500, 40000]],
            'P-E-K-K-A-': [25, 3600, [35000, 42500, 50000]]
        },
        unitsTable = document.querySelector('.js-units'),
        savedData = {};

    if ('localStorage' in window) {
        savedData = localStorage.getItem('savedData');
        if (savedData) {
            savedData = JSON.parse(savedData);
        } else {
            savedData = {};
        }
    }

    var numberFormat = function(n) {
        return n.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,');
    };

    for (var name in data) {
        var unit = data[name],
            unitRow = document.createElement('tr'),
            unitCells = [],
            unitLevelSelect = [];

        unitCells.push('<td><label for="' + name + '">' + name.replace('_', ' ').replace(/-/g, '.') + '</label></td>');

        var levelId = name + '-level',
            levelIndex = 0,
            costPerUnit;
        if (savedData[levelId]) {
            levelIndex = savedData[levelId];
        }
        unitLevelSelect.push('<select id="' + levelId + '" onchange="calculate()">');
        for (var i = 0, levelLength = unit[2].length; i < levelLength; i++) {
            var levelSelected = '';
            if (i == levelIndex) {
                levelSelected = ' selected="selected"';
                costPerUnit = unit[2][i];
            }
            unitLevelSelect.push('<option value="' + unit[2][i] + '"' + levelSelected + '>' + (i + 1) + '</option>');
        }
        unitLevelSelect.push('</select>');
        unitCells.push('<td>' + unitLevelSelect.join('') + '</td>');

        var costId = name + '-cost';
        unitCells.push('<td class="number" id="' + costId + '">' + costPerUnit + '</td>');

        var defaultValue = '';
        if (savedData[name]) {
            defaultValue = savedData[name];
        }
        unitCells.push('<td><input id="' + name + '" size="4" oninput="calculate()" value="' + defaultValue + '"/></td>');

        var summaryId = name + '-summary';
        unitCells.push('<td class="number" id="' + summaryId + '">' + (defaultValue ? numberFormat(costPerUnit * defaultValue) : '') + '</td>');

        unitRow.innerHTML = unitCells.join('');
        unitsTable.appendChild(unitRow);
    }

    var barracks = document.querySelector('.js-barracks'),
        result = document.querySelector('.js-result');

    if (savedData['barracks']) {
        barracks.value = savedData['barracks'];
    }

    window.calculate = function(){
        var totalCost = 0,
            totalSpace = 0,
            totalTime = 0,
            savedData = {};
        for (var name in data) {
            var unit = document.getElementById(name);

            if (unit.value < 0) {
                unit.value = 0;
            } else if (unit.value > 9999) {
                unit.value = 9999;
            }

            var levelId = name + '-level',
                levelEl = document.getElementById(levelId),
                costEl = document.getElementById(name + '-cost'),
                summaryEl = document.getElementById(name + '-summary'),
                costPerUnit = levelEl.value,
                summaryCost = (costPerUnit * unit.value);

            costEl.innerHTML = numberFormat(costPerUnit);
            summaryEl.innerHTML = (summaryCost ? numberFormat(summaryCost) : '');

            totalCost += summaryCost;
            totalSpace += (data[name][0] * unit.value);
            totalTime += (data[name][1] * unit.value);

            savedData[name] = unit.value;
            savedData[levelId] = levelEl.selectedIndex;
        }

        savedData['barracks'] = barracks.value;

        var time = Math.ceil(totalTime / barracks.value),
            formattedTime = '';
        if (time > 3599) {
            formattedTime += Math.floor(time / 3600) + 'h ';
            time = time % 3600;
        }
        if (time > 59) {
            formattedTime += Math.floor(time / 60) + 'm ';
            time = time % 60;
        }
        formattedTime += time + 's';

        var output = [];
        output.push('<tr><th colspan="2">All Troops</th></tr>');
        output.push('<tr><th>Cost</th><td><span class="cost-elixir">' + numberFormat(totalCost) + '</span></td>');
        output.push('<tr><th>Required Space</th><td>' + totalSpace + '</td>');
        output.push('<tr><th>Average Production Time</th><td>' + formattedTime + '</td>');
        result.innerHTML = output.join('');

        if ('localStorage' in window) {
            localStorage.setItem('savedData', JSON.stringify(savedData));
        }
    };

    calculate();

})();
</script>

<!-- Yandex.Metrika counter -->
<script>(function(g,a,i){(a[i]=a[i]||[]).push(function(){try{a.yaCounter19642528=new Ya.Metrika({id:19642528,webvisor:true,clickmap:true,trackLinks:true,accurateTrackBounce:true})}catch(c){}});var h=g.getElementsByTagName("script")[0],b=g.createElement("script"),e=function(){h.parentNode.insertBefore(b,h)};b.type="text/javascript";b.async=true;b.src=(g.location.protocol=="https:"?"https:":"http:")+"//mc.yandex.ru/metrika/watch.js";if(a.opera=="[object Opera]"){g.addEventListener("DOMContentLoaded",e,false)}else{e()}})(document,window,"yandex_metrika_callbacks");</script>
<noscript><div><img src="//mc.yandex.ru/watch/19642528" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<h2>Comments</h2>
<p>Feel free to post bugs and feature suggestions.</p>

<div class="fb-comments" data-href="http://mkln.ru/clash-of-clans/" data-width="470" data-num-posts="5"></div>

<h2>Changelog</h2>
<table class="changelog">
    <tr>
        <td>1.2</td>
        <td>6 February, 2013</td>
        <td>
            Changed favicon to app store game icon;<br />
            Added elixir icon to costs;<br />
            Added intermediate results of the calculations to the units table.<br />
        </td>
    </tr>
    <tr>
        <td>1.1</td>
        <td>5 February, 2013</td>
        <td>
            Added sixth level for Barbarian, Archer, Giant and Balloon;<br />
            Fixed Healer 1st level cost;<br />
            Number of barracks field replaced by the select.<br />
        </td>
    </tr>
    <tr>
        <td>1.0</td>
        <td>4 February, 2013</td>
        <td>Initial release.</td>
    </tr>
</table>

<div class="footer">
    Developed by <a href="/en/">Mikhail Kalashnik</a>
</div>

</body>
</html>
