<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta property="fb:admins" content="splurov"/>
    <title>Clash of Clans — Troops and Spells Cost Calculator</title>
    <style>@font-face{font-family:'PT Serif';src:url('/fonts/PTF55F_W.woff') format('woff')}@font-face{font-family:'PT Serif Caption';src:url('/fonts/PTZ55F_W.woff') format('woff')}html,body{background:#fefefe;color:#222}body{font-family:'PT Serif',Georgia,serif;font-size:18px;line-height:1.5;margin:0;padding:20px 40px}a{white-space:nowrap}a:link{color:#4100f1;text-decoration:none}a:visited{color:#63008c;text-decoration:none}a:hover,a:active{text-decoration:underline}h1{font-size:28px;font-family:'PT Serif Caption',Georgia,sans-serif;font-weight:normal;margin:0 0 12px}h2{font-size:22px;font-family:'PT Serif Caption',Georgia,sans-serif;font-weight:normal;margin:18px 0 4px}p{margin:0 0 12px}.content{min-width:260px;max-width:520px}.photo{margin:8px 0 20px 20px;float:right;border-radius:10px}@media all and (max-width:560px){.photo{float:none;display:block;margin:0 auto 20px}}a.fn.url{color:#222;text-decoration:none}.footer{margin-top:30px;font-size:14px;color:#ccc}.footer a:link{text-decoration:underline;color:#ccc}.footer a:visited{text-decoration:underline;color:#ccc}.footer a:hover,.footer a:active{text-decoration:none}.hidden{display:none}</style>
    <style>input,select{font-family:'PT Serif',Georgia,serif;font-size:inherit}.units{border-spacing:0;margin-bottom:24px}.units th{text-align:left;padding:2px 24px 3px 0;font-weight:normal;font-size:22px}.units td{padding:2px 24px 3px 0}.units td>input{text-align:right}.units tfoot td,.units tfoot th{text-align:right}.units-quantity{font-size:16px}.changelog{border-spacing:0;margin-bottom:12px;font-size:14px}.changelog td{padding:2px 24px 3px 0;vertical-align:top}.todo{font-size:14px}.cost-elixir{background:url(/clash-of-clans/i/elixir.png) no-repeat 100% 50%;padding-right:28px}.cost-gold{background:url(/clash-of-clans/i/gold.png) no-repeat 100% 50%;padding-right:28px}.number-plus,.number-minus{color:#000;cursor:pointer;display:inline-block;margin-left:6px;border:1px solid #aaa;border-radius:8px;padding:0 6px}.number{text-align:right}.limit-exceeded{color:#d00}</style>
    <script>navigator.appName=="Microsoft Internet Explorer"&&(function(b,e,c,a){b.src="/clash-of-clans/i/favicon.ico";c=e.getElementsByTagName("script")[0];a=c.parentNode.insertBefore(e.createElement("link"),c);a.rel="shortcut icon";a.href=b.src})(new Image,document);</script>
    <link rel="icon" href="/clash-of-clans/i/favicon.png"/>
    <script type="text/javascript">

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-37991363-1']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script>
</head>
<body>

<h1>Clash of Clans — Troops and Spells Cost Calculator</h1>

<p>All entered data will be saved in your browser and pre-filled in next time you visit this page.</p>

<table class="units">
    <tr>
        <td>
            <label for="barracks">Number of Barracks</label>
        </td>
        <td>
            <select id="barracks">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected="selected">4</option>
            </select>
        </td>
    </tr>

    <tr>
        <td>
            <label for="barracks-level">Maximum Barracks Level</label>
        </td>
        <td>
            <select id="barracks-level">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10" selected="selected">10</option>
            </select>
        </td>
    </tr>

    <tr>
        <td>
            <label for="army-camps">Army Camps Capacity</label>
        </td>
        <td>
            <input class="js-number" value="220" id="army-camps" size="4"/>
        </td>
    </tr>

    <tr>
        <td>
            <label for="spell-factory-level">Spell Factory Level</label>
        </td>
        <td>
            <select id="spell-factory-level">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected="selected">4</option>
            </select>
        </td>
    </tr>
</table>

<table id="units" class="units">
    <thead>
        <tr>
            <th>Unit</th>
            <th>Level</th>
            <th><span class="cost-elixir">Cost</span></th>
            <th>Quantity <span class="units-quantity" title="Free Capacity" id="units-quantity"></span></th>
            <th><span class="cost-elixir">Total Cost</span></th>
        </tr>
    </thead>
    <tbody id="units-body">
    </tbody>
    <tfoot>
        <tr>
            <th colspan="4">All Troops Cost</th>
            <td id="units-cost"></td>
        </tr>
        <tr>
            <th colspan="4">Capacity</th>
            <td id="units-space"></td>
        </tr>
        <tr>
            <th colspan="4">Average Production Time</th>
            <td id="units-time"></td>
        </tr>
    </tfoot>
</table>

<table id="spells" class="units">
    <thead>
        <tr>
            <th>Spell</th>
            <th>Level</th>
            <th><span class="cost-gold">Cost</span></th>
            <th>Quantity <span class="units-quantity" title="Free Capacity" id="spells-quantity"></span></th>
            <th><span class="cost-gold">Total Cost</span></th>
        </tr>
    </thead>
    <tbody id="spells-body">
    </tbody>
    <tfoot>
        <tr>
            <th colspan="4">All Spells Cost</th>
            <td id="spells-cost"></td>
        </tr>
        <tr>
            <th colspan="4">Capacity</th>
            <td id="spells-space"></td>
        </tr>
        <tr>
            <th colspan="4">Production Time</th>
            <td id="spells-time"></td>
        </tr>
    </tfoot>
</table>

<script>(function(){var p=function(i){return i.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};var n=function(i){var u=localStorage.getItem(i);if(u){u=JSON.parse(u)}else{u={}}this.get=function(w,v){var x=u[w];if(v!==undefined&&x===undefined){return v}return x};this.set=function(v,w){u[v]=w};this.update=function(){localStorage.setItem(i,JSON.stringify(u))};return this};var q=new n("savedData");var c=document.getElementById("barracks");c.options[q.get("barracks",c.selectedIndex)].selected=true;var j=document.getElementById("barracks-level");j.options[q.get("barracksLevel",j.selectedIndex)].selected=true;var l=document.getElementById("army-camps");l.value=q.get("armyCamps",l.value);var h=document.getElementById("spell-factory-level");h.options[q.get("spellFactoryLevel",h.selectedIndex)].selected=true;var k={Barbarian:[20,[25,40,60,80,100,150],1,1],Archer:[25,[50,80,120,160,200,300],1,2],Goblin:[30,[25,40,60,80,100],1,3],Giant:[120,[500,1000,1500,2000,2500,3000],5,4],Wall_Breaker:[120,[1000,1500,2000,2500,3000],1,5],Balloon:[600,[2000,2500,3000,3500,4000,4500],5,6],Wizard:[600,[1500,2000,2500,3000,3500],4,7],Healer:[1200,[7000,10000,13000],20,8],Dragon:[1800,[25000,32500,40000],20,9],"P-E-K-K-A-":[3600,[35000,42500,50000],25,10]},f=document.getElementById("units"),e={Lightning:[3600,[15000,16500,18000,20000,22000],1,1],Healing:[5400,[20000,22000,24000,26500,29000],1,2],Rage:[7200,[30000,33000,36000,40000,44000],1,3],Jump:[5400,[30000,38000],1,4]},a=document.getElementById("spells");var t=function(D,w,L){var A=parseInt(L.levelSelect.value,10);L.table.style.display=(A===0?"none":"");for(var I=parseInt(L.levelSelect.options[L.levelSelect.options.length-1].value);I>=1;I--){document.getElementById(w+"-building-level-"+I).style.display=(I>A?"none":"")}var J=0,B=0,y=0,N;for(N in D){if(D.hasOwnProperty(N)&&D[N][3]<=A){var K=document.getElementById(N);var G=parseInt(K.value,10)||0;var v=N+"-level",E=document.getElementById(v),u=document.getElementById(N+"-cost"),C=document.getElementById(N+"-summary"),M=E.value,H=(M*G);u.innerHTML=p(M);C.innerHTML=(H?p(H):0);J+=H;B+=(D[N][2]*G);y+=(D[N][0]*G);q.set(N,G);q.set(v,E.selectedIndex)}}document.getElementById(w+"-cost").innerHTML=p(J);var F=L.space-B;if(F<0){F='<span class="limit-exceeded">'+F+"</span>"}document.getElementById(w+"-quantity").innerHTML="("+F+")";if(B>L.space){B='<span class="limit-exceeded">'+B+"</span>"}B=B+" / "+L.space;document.getElementById(w+"-space").innerHTML=B;var z=Math.ceil(y/L.buildings),x="";if(z>3599){x+=Math.floor(z/3600)+"h ";z=z%3600}if(z>59){x+=Math.floor(z/60)+"m ";z=z%60}x+=z+"s";document.getElementById(w+"-time").innerHTML=x};var g=function(){t(k,"units",{table:f,levelSelect:j,space:l.value,buildings:c.value});t(e,"spells",{table:a,levelSelect:h,space:h.value,buildings:1});q.set("barracks",c.selectedIndex);q.set("barracksLevel",j.selectedIndex);q.set("armyCamps",l.value);q.set("spellFactoryLevel",h.selectedIndex);q.update()};c.addEventListener("change",g,false);j.addEventListener("change",g,false);l.addEventListener("input",g,false);h.addEventListener("change",g,false);var s=function(u){var w=function(){var x=parseInt(u.value,10);if(isNaN(x)){u.value=1}else{u.value=x+1}g()};var v=function(){var x=parseInt(u.value,10);if(isNaN(x)||x<2){u.value=0}else{u.value=x-1}g()};var i=function(z){var y=document.createElement("span");y.className="number-"+z;y.innerHTML=(z==="plus"?"+":"−");y.onclick=(z==="plus"?w:v);var x=null,A=null;y.onmousedown=function(){A=window.setTimeout(function(){x=window.setInterval((z==="plus"?w:v),100)},500)};y.onmouseup=function(){clearTimeout(A);clearInterval(x)};u.parentNode.appendChild(y)};i("plus");i("minus")};var o=function(F,C){for(var O in F){if(F.hasOwnProperty(O)){var J=F[O],B=document.createElement("tr");B.setAttribute("id",C+"-building-level-"+J[3]);var A=document.createElement("td");A.innerHTML='<label for="'+O+'">'+O.replace("_"," ").replace(/-/g,".")+"</label>";B.appendChild(A);var z=O+"-level",L=q.get(z,0),K,N=[];N.push('<select id="'+z+'">');for(var I=0,D=J[1].length;I<D;I++){var M="";if(I===L){M=' selected="selected"';K=J[1][I]}N.push('<option value="'+J[1][I]+'"'+M+">"+(I+1)+"</option>")}N.push("</select>");var y=document.createElement("td");y.innerHTML=N.join("");y.firstChild.addEventListener("change",g,false);B.appendChild(y);var x=document.createElement("td"),G=O+"-cost";x.setAttribute("id",G);x.className="number";x.innerHTML=K;B.appendChild(x);var H=q.get(O)||0,w=document.createElement("td");if(C==="spells"){var E=[];E.push('<select id="'+O+'">');for(var I=0;I<5;I++){E.push('<option value="'+I+'"'+(I===H?' selected="selected"':"")+">"+I+"</option>")}E.push("</select>");w.innerHTML=E.join("")}else{w.innerHTML='<input class="js-number" id="'+O+'" size="4" value="'+H+'"/>'}w.firstChild.addEventListener((C==="spells"?"change":"input"),g,false);B.appendChild(w);var u=O+"-summary",v=document.createElement("td");v.setAttribute("id",u);v.className="number";v.innerHTML=(H?p(K*H):0);B.appendChild(v);document.getElementById(C+"-body").appendChild(B)}}};o(k,"units");o(e,"spells");var d=document.querySelectorAll(".js-number");var r=function(i){if(i.target.tagName.toLowerCase()==="input"){setTimeout(function(u){u.setSelectionRange(0,9999)}.bind(null,i.target),10)}};for(var m=0,b=d.length;m<b;m++){d[m].addEventListener("focus",r,false);s(d[m])}g()})();</script>

<!-- Yandex.Metrika counter -->
<script>(function(g,a,i){(a[i]=a[i]||[]).push(function(){try{a.yaCounter19642528=new Ya.Metrika({id:19642528,webvisor:true,clickmap:true,trackLinks:true,accurateTrackBounce:true})}catch(c){}});var h=g.getElementsByTagName("script")[0],b=g.createElement("script"),e=function(){h.parentNode.insertBefore(b,h)};b.type="text/javascript";b.async=true;b.src=(g.location.protocol=="https:"?"https:":"http:")+"//mc.yandex.ru/metrika/watch.js";if(a.opera=="[object Opera]"){g.addEventListener("DOMContentLoaded",e,false)}else{e()}})(document,window,"yandex_metrika_callbacks");</script>
<noscript><div><img src="//mc.yandex.ru/watch/19642528" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<h2>Comments</h2>
<p>Feel free to post bugs and feature suggestions.</p>

<div class="fb-comments" data-href="http://mkln.ru/clash-of-clans/" data-width="470" data-num-posts="5"></div>

<h2>Changelog</h2>
<table class="changelog">
    <tr>
        <td>1.3.2</td>
        <td>10 February, 2013</td>
        <td>
            Default values changed to maximum allowed in game.<br/>
        </td>
    </tr>
    <tr>
        <td>1.3.1</td>
        <td>9 February, 2013</td>
        <td>
            Added auto-select of text in fields for simplify edit in iOS;<br/>
            Fixed NaN in results and null in fields bug.<br/>
        </td>
    </tr>
    <tr>
        <td>1.3</td>
        <td>8 February, 2013</td>
        <td>
            The title is replaced by the more similar to the contents of the page;<br/>
            Added description for auto-save feature;<br/>
            Added army camps capacity — allows to show free capacity;<br/>
            Added maximum barracks level — allows show/hide unavailable units;<br/>
            Added spells calculation.<br/>
        </td>
    </tr>
    <tr>
        <td>1.2</td>
        <td>6 February, 2013</td>
        <td>
            Added plus/minus buttons;<br/>
            Fixed IE 9+ support;<br/>
            Changed favicon to app store game icon;<br/>
            Added elixir icon to costs;<br/>
            Added intermediate results of the calculations to the units table.<br/>
        </td>
    </tr>
    <tr>
        <td>1.1</td>
        <td>5 February, 2013</td>
        <td>
            Added sixth level for Barbarian, Archer, Giant and Balloon;<br/>
            Fixed Healer 1st level cost;<br/>
            Number of barracks field replaced by the select.<br/>
        </td>
    </tr>
    <tr>
        <td>1.0</td>
        <td>4 February, 2013</td>
        <td>Initial release.</td>
    </tr>
</table>

<h2>To-do</h2>
<div class="todo">
    <p>Distribution of troops between barracks for optimal training speed.</p>
    <p>(?) Save results to simplify comparison of different sets.</p>
    <p>(?) Gem costs.</p>
</div>

<div class="footer">
    Developed by <a href="/en/">Mikhail Kalashnik</a>
</div>

</body>
</html>
