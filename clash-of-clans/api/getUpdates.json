{"clash_of_clans":{"code":{"html":"<!DOCTYPE HTML> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"/> <meta name=\"viewport\" content=\"width=950\"/> <style>html,body{background:#fefefe;color:#222}body{font-family:'PT Sans',Arial,sans-serif;margin:13px 17px;line-height:1.4;font-size:16px;-webkit-text-size-adjust:100%}a{white-space:nowrap}a:link{color:#4100f1}a:link,a:visited{text-decoration:none}a:visited{color:#63008c}a:hover,a:active{text-decoration:underline}kbd{font-family:inherit;background:#f0f0f0;border:1px solid #ddd;border-radius:5px;padding:0 4px}input,select,textarea{font-family:inherit;font-size:inherit;vertical-align:middle}.field-long{width:100%}.near-field{vertical-align:middle}h1{font-size:22px;margin:0 0 3px}h2{font-size:18px;margin:13px 0 8px}h2+table{margin-top:1px}h3{font-size:14px;margin:17px 0 2px}p{margin:0 0 10px}table{border-spacing:0}table td,table th{vertical-align:top;padding:0}.number{text-align:right}.wikia-link:link,.wikia-link:visited{color:inherit;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAA/1BMVEX///8AAABAQEANDQ1TU1M/Pz8MDAxHR0cAAABAQEBhYWFOTk4AAABMTEwYGBhhYWFHR0dWVlYAAABLS0sYGBhOTk5VVVVUVFQ+Pj4AAAAAAABpaWloaGhmZmZiYmJnZ2f+/v6jo6Pc3Nxvb29eXl5cXFxkZGRlZWW6urptbW2pqam1tbXW1tb4+Pi2trZqamp8fHxfX1+0tLTg4OC4uLizs7P9/f1ubm5/f39wcHBbW1vd3d1ra2uoqKj5+fl+fn7Pz8+RkZGtra3t7e13d3eCgoKwsLB7e3uSkpKvr6/Y2NjZ2dl1dXXb29uqqqqkpKTi4uLk5ORjY2N4eHiLi4spHuS/AAAAG3RSTlMADasU0KsVsROo+cQPvUD3s9kMvD/B1dKoCw76qK6PAAAA6klEQVR4Xk3L1XaDQABFUQIkdfeO4m5x91Rd/v9bOkMHynnc615JpKjQESFUQQABj/xj48q4c9ss94E4Be7vjZc0z4UlSoeXwI84toEj1f463d6yN6sCZbnO2znY7T/RAjGGPW/gEXQfMllFOQ4zrdXSF3g2Yva88bsu5BjT6WSc6szCvp0sHxOOAdW+vvlXT4+OTxIDQo5dH63nlI5m6Ew5v1BVlWGHRk0ymIcpRtc30m1DUXKk0yZ5WcOFV69JvBy52njyalSR69t79FFZxlT02SvQMn/iDisIYg2UaJmZyMRyidZQZBX4C/BhL9uWDiH6AAAAAElFTkSuQmCC) no-repeat 100% .25em;background-size:10px 10px;padding-right:15px;text-decoration:none}.wikia-link:hover,.wikia-link:active{text-decoration:underline}.data{-webkit-transform:translateZ(0);-webkit-font-smoothing:subpixel-antialiased}.data th,.data td{padding-left:7px;padding-right:7px;white-space:nowrap;border-bottom:1px solid #ddd;border-right:1px solid #ddd}.data th{text-align:left;padding-bottom:1px;line-height:20px}.data td{padding-top:2px;padding-bottom:2px;vertical-align:middle}.data td>input{text-align:right}.data tfoot tr:last-child td{border-bottom:0}.data th:last-child,.data td:last-child{border-right:0}.data th:first-child,.data td:first-child{padding-left:0}.data-secondary{font-size:13px}.list-content{margin-bottom:10px}.list-content_small{font-size:14px}.list-content ul{padding:0;margin:0;list-style:none}.list-content li{padding-left:12px;position:relative}.list-content li:before{content:'•';position:absolute;left:0}.list-content p{margin:0 0 1px}.list-content__date{color:#777}.cost-elixir{background-position:100% 50%;background-image:url(data:image/png;base64,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);background-repeat:no-repeat;background-size:14px 16px;padding-right:19px}.cost-dark-elixir{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAD80lEQVR42q2XS0hUYRiGc0bHGW9z8T7jjI6O10wFNTGpwETaSTFkgkLSKpLCIBiCGggKgmBaRq4El1KbNl02Ii0qioIWLVpUuFBaFBKUk56v9z34i/xzRg6OBx7O/Xv/9/u+/58zh0TkQMDmBH4QBT3gFDgM8nc/l6tICRgGSfAYvAar4C8wwBo4nbMgtiC4DF6Bn0CysAVm9iuoHF0CH4HYYMvhcFzblyC2o+AJSAMBhh1RCN63JYgtb3tfDK6CFRsCupgUFRU9Y2ZsOcQWAnNgU3NlC6fTKT6f73tpaWmbHYcR8BRIDhhwuFleXj6mC+ppPAbeAskVCIrX673H2JYOXS5XV15e3qdchRRut1sqKyuf19XVeTIEKyoqavPz819q9cqZ6urqFVXH3el0ocgP4Y4nB0pZWdkGmueCLngObNhpdQWyYXaix+ORQCAgxcXFYjXgwsJCiUQi8zh27G7/D1YCDFBSUsI6cKRsAp6TnesDAwMyOTkp4+Pj0tDQkBEDfSE1NTVvuLgrwRtZHLHDpLOzU/r6+qS5uVlQZ4Up1tvbK4lEQpaWlmR5eVmmp6eloKAgYz5WVVV9CwaDEYoFwPts7jCHpKenx3TR3t4ueMmktrZWwuGwDA8PSyqVkrW1NVlfX5dkMslMZMSJRqO/hoaG+ig4mq12HBm6S+rr6yUWi7EOEgqFuKeYeX1wcFBmZ2dlcXHRZGJiglNBj0XBf8jUGQpez+KOLzKldMmUKFd8mVDQdD0yMiJTU1MSj8elra2NDZURj7VtbW29SMHbVoLsQDaF3++nGJ0pdxQzHTc1NUljY6O0tLRQmANgRqw61dh+foaCd9VFrZVZC7a7EqQ7jpQiFCQU5yDoXk0NOtSzZSCdbLorFLyjCfKF3YLsRuWOLpQoxXisBJkNloECeraM/v5+ZsJ0eMuqfmxtjpZBKMjOpEOsiUqY8Jj3OE1Yb3PO6fEYB4JpPDdGwbMgraeULjlaLEmqYZSYgue8zrVSpZOdrQtyYJyvXFgqKegFy8BqhVBpZVCuFkwtHRGe0z3vs1mYFculsKury+ju7k7srKUYVRw3/2RJLbuVQdX0oAiPCVPO+0pMh89T8AUXGCVIl24wb9Gtqujqh5QC3NM54cLN+5aLNt/p6Oj4gdSfpI7+axHTFnBdlDVlEKIJWa5S7GQDC0FSaRCrT8F32UQZnDVhMH2u6WJwxXm64MOmC+qiR8BLIPv45TdQSzbWb6wqc8hEUI+f7YutHCTAqlVQDeWeaWaTfMF8Pc8/N1pcW9+lJ8AC+Aq29qhvGnPwMyb/I7jq3Sum3c/8MBgFN0EKPCBIXwpCCTTTcexr7MT6D9eNFIrhqHsGAAAAAElFTkSuQmCC);background-size:14px 16px}.cost-dark-elixir,.cost-gold{background-position:100% 50%;background-repeat:no-repeat;padding-right:19px}.cost-gold{background-image:url(data:image/png;base64,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);background-size:15px 16px}.button,.button:link,.button:visited{color:#444;cursor:pointer;display:inline-block;padding:3px 7px;border:1px solid #999;border-radius:5px;background-color:#fcfcfc;background-image:-webkit-linear-gradient(#fcfcfc,#ececec);background-image:-o-linear-gradient(#fcfcfc,#ececec);background-image:linear-gradient(#fcfcfc,#ececec);line-height:1;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-weight:400;text-decoration:none}.button:hover{background-image:-webkit-linear-gradient(#fcfcfc,#e0e0e0);background-image:-o-linear-gradient(#fcfcfc,#e0e0e0);background-image:linear-gradient(#fcfcfc,#e0e0e0)}.button:active{color:#444;background:#e3e3e3}.button_after{margin-left:7px}.button_middle{vertical-align:middle}.button_social,.button_social:link,.button_social:visited{border-color:#99b;padding-top:4px;padding-bottom:4px;background-color:#fcfcff;background-image:-webkit-linear-gradient(#fcfcff,#ececff);background-image:-o-linear-gradient(#fcfcff,#ececff);background-image:linear-gradient(#fcfcff,#ececff);font-size:14px}.button_social:hover{background-image:-webkit-linear-gradient(#fcfcff,#e0e0ff);background-image:-o-linear-gradient(#fcfcff,#e0e0ff);background-image:linear-gradient(#fcfcff,#e0e0ff)}.button_social:active{background:#e3e3ff}.icon-twitter{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAaCAMAAADhRa4NAAAAM1BMVEX///8Aq+0An98AquoArO4Aq+4ArO0Aq+sAp+cAq+4Aq+0Aq+0ArO4AquwArO4AqewArO4ca5ejAAAAEHRSTlMAgBAw78+fQCC/j3DfYK9QmmwCjwAAALBJREFUeF6V0NuOwzAIBNABG9/TzP9/7WqTKMWtW6nnddAgwELZRLILNMDTxH9xB/Z6RGLqc+PFIusRVJrrePDJghQAZ9+lcNIBYJDko+DQ6TVfmjIACJ0Nh8zLSD0nOu6uNZxiit8HjB8YTsIPEk46uLbjEiJXIm7aViPi/78QFbfAhQ5n45uKSaicDcWLYHRiwKxIpGMFNxWRZpw0/bq+ZrwormG0gBXNXUS2rPjZHwABG0b9SIF7AAAAAElFTkSuQmCC);background-size:16px 13px;padding-left:19px}.icon-twitter,.icon-facebook{background-position:0 50%;background-repeat:no-repeat}.icon-facebook{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAn1BMVEU7WZj///9DYZ1IZaBJZqGwvdd4jrpCYJ09W5mquNRUcKZngLDv8vdEYp2rudRlfrBJZ6H4+vxAXZtAXptTb6VHZJ/09vlYc6jL1OVMaaKRosZ5j7q2wdnn7PNogLFDYJxGY57y9Pk+XJpRbKTz9flthLRdd6tBXpvH0eOvvNaYqMl9kbv+/v75+vyvvdZVcKbt8PaVpsjp7fTn6/O1wdjusJcKAAAAjUlEQVR4Xu3QxwrDMAyAYcnOTvfee+/1/s9WiVJoCZYg9Nj/JKzvIkMcgpDxYQxiFpRqOUE0byfdtRM0Bi2kDi6QTvGVAzQvKIMrKqDD4N7rB4EDDBmMhDMLDCYaKOYEszK1YLCkYZUFFfxso4GtBnYa2GeBKVFHBicazr/9hz8wMvDAt/XvblXq/eg9nvadC9GU/sKFAAAAAElFTkSuQmCC);background-size:16px 16px;padding-left:21px}.icon-save{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAABVElEQVR4Ac3PP2tTURjH8c9zkwbb4lCH+t/ZQsGls7uj4KZBwUUHUVzFweLQSUhBdBSquAiuDr4BRycV34DgYKCYhrS9R3Do4Sbcg9n8PPOX8ztct23w957bMKvSEdjw0hPnHNmRjq4vNC254p41oS9JXjkDVA5ktaTphPu2XUYNbtpyCipltTEOZH1PnaYyv9seUikLndldsy8m08a++e6HpJbt00V23rqm8NY7e9ZdIJsONz0WmhJCslAKe3r+UaXsPwq7INn1W6AsWXZc5HBkywsLkpKw765HlnNYGxo6a0nJyE9DNTkMgWsuStqErwZC5BACbxxTMkbQDGGibALTYcIDlxxq0/HZpsTs1IFe8Y+TtqkdXSWHbVNvWVNrU/ni2fTUJOG9j0p2kaQcUlmxas9ISVi1osohi+64qqOMQyctAmHHDfN6rd/1wS/JPMIn/gAxq1uCJqJ7igAAAABJRU5ErkJggg==);background-size:14px 14px;background-position:0 1px;padding-left:19px;background-repeat:no-repeat}.limit-exceeded{color:#d00}.fixed-content{max-width:800px}.result{font-weight:700}.tooltip{cursor:help}.block-indented{margin-top:30px}.message{font-size:14px;background:#cfc;border:1px solid #8f8;border-radius:5px;padding:3px 7px;line-height:1;vertical-align:middle;font-weight:400}.message_closeable{cursor:pointer}.message_after{margin-left:15px}.message_negative{background:#fdd;border:1px solid #f88}.message_block{display:block}.saved-list{font-size:14px}.saved-list__item{display:inline-block;margin:0 13px 13px 0;border:1px solid #ddd;border-radius:10px;padding:6px 7px 10px;vertical-align:top;color:#444;line-height:1.35}.saved-list__item-title{font-weight:700;color:#222;margin-top:3px;margin-bottom:8px}.saved-list__actions{margin-top:8px}.saved-list__table td{padding-right:8px}.saved-list__item-result{font-size:12px;color:#999;font-weight:700}.footer{border-top:1px solid #ddd;padding-top:12px;margin-top:30px;font-size:14px;color:#999}.footer a:link,.footer a:visited{text-decoration:underline;color:#999}.footer a:hover,.footer a:active{text-decoration:none}.menu-wrapper{position:relative;margin:20px -17px 14px}.menu{list-style:none;padding:0;margin:0;width:100%;background:#fafafa;box-shadow:0 0 5px #bbb;border-collapse:separate;font-size:15px;z-index:500}.menu_fixed{position:fixed;top:0;left:0;box-shadow:0 3px 8px #ccc}.menu li{display:inline-block}.menu li:first-child{margin-left:17px}.menu__item{display:inline-block;padding:4px 10px;border-right:1px solid #d9d9d9;color:#000;cursor:pointer}.menu li:first-child .menu__item{margin-left:-10px}.menu li:last-child .menu__item{border-right:0}.menu .menu__item:hover{background:#efefef}</style> </head> <body> <style> .app-version-updated { display: none; } #app_version.updated + .app-version-updated { position: absolute; top: 30px; left: -12px; border: 2px solid #900; border-radius: 10px; padding: 10px; display: block; background: #ffeeee; font-weight: bold; z-index: 100; } </style> <p style=\"position: relative;\"> Last Update: <span id=\"app_version\" class=\"updated\"></span> <span id=\"app-updated\" class=\"app-version-updated\">Version updated!</span> </p> <script> document.getElementById('app-updated').ontouchend = function(e) { e.preventDefault(); e.stopPropagation(); document.getElementById('app_version').className = ''; }; </script> <div class=\"menu-wrapper js-menu-wrapper\"> <ul class=\"menu js-menu\"> <li><span class=\"menu__item js-anchor\" data-anchor-target=\"barracks-anchor\">Barracks</span></li><!-- --><li><span class=\"menu__item js-anchor\" data-anchor-target=\"dark-anchor\">Dark Barracks</span></li><!-- --><li><span class=\"menu__item js-anchor\" data-anchor-target=\"spell-anchor\">Spell Factory</span></li><!-- --><li><span class=\"menu__item js-anchor js-share\" data-anchor-target=\"share-anchor\">Share Composition</span></li><!-- --><li><span class=\"menu__item js-save-composition\" data-scroll=\"yes\"><span class=\"icon-save\">Save Composition</span></span></li><!-- --><li><span class=\"menu__item js-anchor\" data-anchor-target=\"saved-anchor\">Saved Compositions</span></li> </ul> </div> <p> <span id=\"view-shared\" class=\"message message_closeable\" style=\"display: none;\" title=\"Click to hide\"> You are viewing shared composition (you can find previous one in the saved compositions) </span> </p> <h2 id=\"barracks-anchor\"> <a href=\"http://clashofclans.wikia.com/wiki/Barracks\" class=\"wikia-link\" target=\"_blank\">Barracks</a> <span class=\"message message_negative message_after\" style=\"display: none;\" id=\"units-barracks-exceeded\">Too many units</span> </h2> <table id=\"units\" class=\"data\"> <thead> <tr> <th>Unit</th> <th>Level</th> <th> Quantity <span class=\"data-secondary tooltip\" title=\"Army Camps Free Capacity\" id=\"units-quantity\"></span> <br/><span class=\"button data-secondary js-reset\" data-reset-type=\"units\" data-scope=\"quantity\">Reset</span> </th> <th><span class=\"cost-elixir\">Total</span></th> <th> Subtract <br/><span class=\"button data-secondary js-reset\" data-reset-type=\"units\" data-scope=\"subtract\">Reset</span> </th> <th> <select id=\"barracks-levels-1\" tabindex=\"1\"> </select> <span class=\"near-field\">lvl</span><br/> <span id=\"units-barrack-header-1\"></span> </th> <th> <select id=\"barracks-levels-2\" tabindex=\"5\"> </select> <span class=\"near-field\">lvl</span><br /> <span id=\"units-barrack-header-2\"></span> </th> <th> <select id=\"barracks-levels-3\" tabindex=\"10\"> </select> <span class=\"near-field\">lvl</span><br/> <span id=\"units-barrack-header-3\"></span> </th> <th> <select id=\"barracks-levels-4\" tabindex=\"15\"> </select> <span class=\"near-field\">lvl</span><br/> <span id=\"units-barrack-header-4\"></span> </th> </tr> </thead> <tbody id=\"units-body\"> </tbody> <tfoot> <tr> <td colspan=\"2\" class=\"data-secondary number\"> <label for=\"army-camps\"><a href=\"http://clashofclans.wikia.com/wiki/Army_Camp\" class=\"wikia-link\" target=\"_blank\">Army Camps</a> Capacity:</label></td> <td> <span id=\"units-space\" class=\"result near-field\"></span> <select id=\"army-camps\" data-object-type=\"all\" tabindex=\"19\"> </select> </td> <td id=\"units-cost\" class=\"number result\"></td> <td id=\"units-subtracted-cost\" class=\"data-secondary\"></td> <td id=\"units-time-barrack-1\" class=\"number\"></td> <td id=\"units-time-barrack-2\" class=\"number\"></td> <td id=\"units-time-barrack-3\" class=\"number\"></td> <td id=\"units-time-barrack-4\" class=\"number\"></td> </tr> </tfoot> </table> <h2 id=\"dark-anchor\"> <a href=\"http://clashofclans.wikia.com/wiki/Dark_Barracks\" class=\"wikia-link\" target=\"_blank\">Dark Barracks</a> <span class=\"message message_negative message_after\" style=\"display: none;\" id=\"dark-barracks-exceeded\">Too many units</span> </h2> <table id=\"dark\" class=\"data\"> <thead> <tr> <th>Unit</th> <th>Level</th> <th> Quantity <span class=\"data-secondary tooltip\" title=\"Army Camps Free Capacity\" id=\"dark-quantity\"></span> <br/><span class=\"button data-secondary js-reset\" data-reset-type=\"dark\" data-scope=\"quantity\">Reset</span> </th> <th><span class=\"cost-dark-elixir\">Total</span></th> <th> Subtract <br/><span class=\"button data-secondary js-reset\" data-reset-type=\"dark\" data-scope=\"subtract\">Reset</span> </th> <th> <select id=\"dark-barracks-levels-1\" tabindex=\"20\"> </select> <span class=\"near-field\">lvl</span><br/> <span id=\"dark-barrack-header-1\"></span> </th> <th> <select id=\"dark-barracks-levels-2\" tabindex=\"25\"> </select> <span class=\"near-field\">lvl</span><br/> <span id=\"dark-barrack-header-2\"></span> </th> </tr> </thead> <tbody id=\"dark-body\"> </tbody> <tfoot> <tr> <td></td> <td></td> <td id=\"dark-space\" class=\"result\"></td> <td id=\"dark-cost\" class=\"number result\"></td> <td id=\"dark-subtracted-cost\" class=\"data-secondary\"></td> <td id=\"dark-time-barrack-1\" class=\"number\"></td> <td id=\"dark-time-barrack-2\" class=\"number\"></td> </tr> </tfoot> </table> <h2 id=\"spell-anchor\"><a href=\"http://clashofclans.wikia.com/wiki/Spell_Factory\" class=\"wikia-link\" target=\"_blank\">Spell Factory</a></h2> <table id=\"spells\" class=\"data\"> <thead> <tr> <th>Spell</th> <th>Level</th> <th>Quantity <span class=\"data-secondary tooltip\" title=\"Spell Factory Free Capacity\" id=\"spells-quantity\"></span></th> <th><span class=\"cost-gold\">Total</span></th> <th> <select id=\"spell-factory-level\" tabindex=\"35\"> </select> <span class=\"near-field\">lvl</span> </th> </tr> </thead> <tbody id=\"spells-body\"> </tbody> <tfoot> <tr> <td></td> <td></td> <td class=\"result\" id=\"spells-space\"></td> <td id=\"spells-cost\" class=\"number result\"></td> <td class=\"result number\" id=\"spells-time\"></td> </tr> </tfoot> </table> <div class=\"js-share\"> <h2 class=\"block-indented\" id=\"share-anchor\">Share Composition</h2> <p class=\"fixed-content\"> <input id=\"share-permalink\" class=\"field-long\" tabindex=\"1901\"/> </p> <p> <a href=\"\" target=\"_blank\" id=\"share-twitter\" class=\"button button_social\" tabindex=\"1903\"> <span class=\"icon-twitter\">Share Composition on Twitter</span> </a> <a href=\"\" target=\"_blank\" id=\"share-facebook\" class=\"button button_after button_social\" tabindex=\"1904\"> <span class=\"icon-facebook\">Share Composition on Facebook</span> </a> </p> <p class=\"fixed-content block-indented\"> <textarea id=\"share-text\" class=\"field-long\" tabindex=\"1905\" rows=\"2\"></textarea> </p> </div> <h2 class=\"block-indented\" id=\"saved-anchor\">Saved Compositions</h2> <p>Values from the “Subtract” columns not saved.</p> <p> <span class=\"js-save-composition button\" tabindex=\"2000\"><span class=\"icon-save\">Save Composition</span></span> <span id=\"already-saved\" class=\"message message_after message_closeable\" style=\"display: none;\" title=\"Click to hide\"> Already in the saved compositions </span> </p> <div id=\"saved-list\" class=\"saved-list\"> <div id=\"saved-list-content\" class=\"saved-list__content\"> </div> </div> <script>/** * @preserve Copyright 2012 Twitter, Inc. * @license http://www.apache.org/licenses/LICENSE-2.0.txt */ var Hogan={};(function(a,b){function i(a){return String(a===null||a===undefined?\"\":a)}function j(a){return a=i(a),h.test(a)?a.replace(c,\"&amp;\").replace(d,\"&lt;\").replace(e,\"&gt;\").replace(f,\"&#39;\").replace(g,\"&quot;\"):a}a.Template=function(a,c,d,e){this.r=a||this.r,this.c=d,this.options=e,this.text=c||\"\",this.buf=b?[]:\"\"},a.Template.prototype={r:function(a,b,c){return\"\"},v:j,t:i,render:function(b,c,d){return this.ri([b],c||{},d)},ri:function(a,b,c){return this.r(a,b,c)},rp:function(a,b,c,d){var e=c[a];return e?(this.c&&typeof e==\"string\"&&(e=this.c.compile(e,this.options)),e.ri(b,c,d)):\"\"},rs:function(a,b,c){var d=a[a.length-1];if(!k(d)){c(a,b,this);return}for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return k(a)&&a.length===0?!1:(typeof a==\"function\"&&(a=this.ls(a,b,c,d,e,f,g)),h=a===\"\"||!!a,!d&&h&&b&&b.push(typeof a==\"object\"?a:b[b.length-1]),h)},d:function(a,b,c,d){var e=a.split(\".\"),f=this.f(e[0],b,c,d),g=null;if(a===\".\"&&k(b[b.length-2]))return b[b.length-1];for(var h=1;h<e.length;h++)f&&typeof f==\"object\"&&e[h]in f?(g=f,f=f[e[h]]):f=\"\";return d&&!f?!1:(!d&&typeof f==\"function\"&&(b.push(g),f=this.lv(f,b,c),b.pop()),f)},f:function(a,b,c,d){var e=!1,f=null,g=!1;for(var h=b.length-1;h>=0;h--){f=b[h];if(f&&typeof f==\"object\"&&a in f){e=f[a],g=!0;break}}return g?(!d&&typeof e==\"function\"&&(e=this.lv(e,b,c)),e):d?!1:\"\"},ho:function(a,b,c,d,e){var f=this.c,g=this.options;g.delimiters=e;var d=a.call(b,d);return d=d==null?String(d):d.toString(),this.b(f.compile(d,g).render(b,c)),!1},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join(\"\");return this.buf=[],a}:function(){var a=this.buf;return this.buf=\"\",a},ls:function(a,b,c,d,e,f,g){var h=b[b.length-1],i=null;if(!d&&this.c&&a.length>0)return this.ho(a,h,c,this.text.substring(e,f),g);i=a.call(h);if(typeof i==\"function\"){if(d)return!0;if(this.c)return this.ho(i,h,c,this.text.substring(e,f),g)}return i},lv:function(a,b,c){var d=b[b.length-1],e=a.call(d);if(typeof e==\"function\"){e=i(e.call(d));if(this.c&&~e.indexOf(\"{{\"))return this.c.compile(e,this.options).render(d,c)}return i(e)}};var c=/&/g,d=/</g,e=/>/g,f=/\\'/g,g=/\\\"/g,h=/[&<>\\\"\\']/,k=Array.isArray||function(a){return Object.prototype.toString.call(a)===\"[object Array]\"}})(typeof exports!=\"undefined\"?exports:Hogan)</script> <script>(function() { 'use strict'; var mk = {}; window.mk = mk; mk.ios = !!navigator.userAgent.match(/(?:iPad|iPhone|iPod)/i); mk.toArray = function(likeArrayObject) { var resultArray = []; var i; var l; for (i = 0, l = likeArrayObject.length; i < l; i++) { resultArray.push(likeArrayObject[i]); } return resultArray; }; if (!Function.prototype.bind) { Function.prototype.bind = function(context) { var self = this; var args = mk.toArray(arguments).slice(1); return function() { return self.apply(context, args.concat(mk.toArray(arguments))); }; }; } mk.objectIterate = function(obj, callback) { var key; for (key in obj) { if (obj.hasOwnProperty(key)) { if (callback(key, obj[key]) === false) { break; } } } }; mk.objectCopy = function(obj) { var newObj = obj.constructor(); mk.objectIterate(obj, function(key, value) { newObj[key] = value; }); return newObj; }; mk.objectExtend = function(target, object) { if (!object) { return target; } var finalObject = target; mk.objectIterate(object, function(key, value) { if (Object.prototype.toString.call(value) === '[object Object]') { finalObject[key] = mk.objectCopy(value); } else { finalObject[key] = value; } }); return finalObject; }; mk.numberFormat = function(n) { return n.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','); }; mk.convertToTitle = function(s) { return s.replace('_', ' ').replace(/-/g, '.'); }; mk.getFormattedTime = function(time, hideSeconds) { var formattedTime = ''; var remainingTime = time; if (remainingTime > 3599) { formattedTime += Math.floor(remainingTime / 3600) + 'h '; remainingTime %= 3600; } if (remainingTime > 59) { var minutes = Math.floor(remainingTime / 60); remainingTime %= 60; if (hideSeconds && remainingTime > 0) { minutes++; } formattedTime += minutes + 'm '; } else { formattedTime += '0m '; } if (formattedTime === '' || !hideSeconds) { formattedTime += remainingTime + 's'; } return formattedTime; }; mk.Dict = function(data) { this.data = data; this.get = function(key, defaultValue) { var value = this.data[key]; if (defaultValue !== undefined && (value === undefined || value === null)) { return defaultValue; } return value; }; this.set = function(key, value) { this.data[key] = value; }; this.getAll = function() { return this.data; }; }; mk.MultiDict = function(entries) { this.entries = []; this.retrieve = function(i) { return this.entries[i] || new mk.Dict({}); }; this.update = function(i, data) { this.entries[i] = data; }; this.insert = function(data) { this.entries.push(new mk.Dict(data)); }; this.remove = function(i) { this.entries.splice(i, 1); }; this.getAll = function() { return this.entries.map(function(entry) { return entry.getAll(); }); }; this.forEach = function(callback) { this.entries.forEach(callback); }; entries.forEach(this.insert.bind(this)); }; mk.addEvents = function(el, eventNames, handler) { eventNames.forEach(function(eventName) { el.addEventListener(eventName, handler, false); }); }; mk.getAllByClass = function(cssClass, customContext) { return mk.toArray((customContext || document).getElementsByClassName(cssClass)); }; mk.getAll = function(selector, customContext) { return mk.toArray((customContext || document).querySelectorAll(selector)); }; mk.selectAll = function(e) { if (['input', 'textarea'].indexOf(e.currentTarget.tagName.toLowerCase()) !== -1) { setTimeout(function(el) { el.setSelectionRange(0, el.value.length); }.bind(null, e.currentTarget), 10); } }; mk.infoMessage = function(id, isAutoHide) { var el = document.getElementById(id); var timeout; var hide = function(e) { if (e) { e.preventDefault(); e.stopPropagation(); } clearTimeout(timeout); el.style.display = 'none'; }; mk.addEvents(el, ['click', 'touchend'], hide); return { 'show': function() { el.style.display = 'inline-block'; if (isAutoHide) { timeout = setTimeout(function() { el.style.display = 'none'; }, 2000); } }, 'hide': hide }; }; mk.getTopPosition = function(el) { var position = 0; do { position += el.offsetTop; } while (el = el.offsetParent); return position; }; mk.Events = { events: {}, trigger: function(name, data) { if (this.events[name]) { this.events[name].forEach(function(event) { event(data); }); } }, listen: function(name, cb) { if (!this.events[name]) { this.events[name] = []; } this.events[name].push(cb); } }; }()); (function(mk) { 'use strict'; mk.calc = {}; mk.calc.types = { 'units': { 'Barbarian': [20, [25, 40, 60, 80, 100, 150], 1, 1], 'Archer': [25, [50, 80, 120, 160, 200, 300], 1, 2], 'Goblin': [30, [25, 40, 60, 80, 100], 1, 3], 'Giant': [120, [500, 1000, 1500, 2000, 2500, 3000], 5, 4], 'Wall_Breaker': [120, [1000, 1500, 2000, 2500, 3000, 3500], 2, 5], 'Balloon': [600, [2000, 2500, 3000, 3500, 4000, 4500], 5, 6], 'Wizard': [600, [1500, 2000, 2500, 3000, 3500], 4, 7], 'Healer': [900, [5000, 6000, 8000, 10000], 14, 8], 'Dragon': [1800, [25000, 30000, 36000, 42000], 20, 9], 'P-E-K-K-A-': [2700, [30000, 35000, 42000, 50000], 25, 10] }, 'dark': { 'Minion': [45, [6, 7, 8, 9, 10], 2, 1], 'Hog Rider': [300, [30, 35, 40, 45, 50], 5, 2], 'Valkyrie': [900, [70, 100, 130, 160], 8, 3], 'Golem': [2700, [450, 525, 600, 675, 750], 30, 4], 'Witch': [1200, [250, 350], 12, 5] }, 'spells': { 'Lightning': [1800, [15000, 16500, 18000, 20000, 22000, 24000], 1, 1], 'Healing': [1800, [20000, 22000, 24000, 26500, 29000, 32000], 1, 2], 'Rage': [2700, [30000, 33000, 36000, 40000, 44000], 1, 3], 'Jump': [2700, [30000, 38000], 1, 4], 'Freeze': [2700, [35000, 40000, 45000], 1, 5] } }; var armyCampsData = { 'base': [20, 40, 50], 'step': 5, 'max': 240 }; mk.calc.barracksData = { 'units': { 'prefix': 'barracks', 'count': 4, 'queue': [0, 20, 25, 30, 35, 40, 45, 50, 55, 60, 75], 'maxLevel': 10, 'firstRequired': true }, 'dark': { 'prefix': 'dark-barracks', 'count': 2, 'queue': [0, 40, 50, 60, 70, 80], 'maxLevel': 5 } }; mk.calc.spellFactoryData = { 'max': 5 }; mk.calc.saveMappingKeys = [ 'barracks-levels-1', 'barracks-levels-2', 'barracks-levels-3', 'barracks-levels-4', 'dark-barracks-levels-1', 'dark-barracks-levels-2', 'armyCamps', 'spellFactoryLevel', 'Barbarian', 'Archer', 'Goblin', 'Giant', 'Wall_Breaker', 'Balloon', 'Wizard', 'Healer', 'Dragon', 'P-E-K-K-A-', 'Barbarian-level', 'Archer-level', 'Goblin-level', 'Giant-level', 'Wall_Breaker-level', 'Balloon-level', 'Wizard-level', 'Healer-level', 'Dragon-level', 'P-E-K-K-A--level', 'Barbarian-subtract', 'Archer-subtract', 'Goblin-subtract', 'Giant-subtract', 'Wall_Breaker-subtract', 'Balloon-subtract', 'Wizard-subtract', 'Healer-subtract', 'Dragon-subtract', 'P-E-K-K-A--subtract', 'Lightning', 'Healing', 'Rage', 'Jump', 'Lightning-level', 'Healing-level', 'Rage-level', 'Jump-level', 'Minion', 'Hog Rider', 'Valkyrie', 'Golem', 'Minion-level', 'Hog Rider-level', 'Valkyrie-level', 'Golem-level', 'Minion-subtract', 'Hog Rider-subtract', 'Valkyrie-subtract', 'Golem-subtract', 'Freeze', 'Freeze-level', 'Witch', 'Witch-level', 'Witch-subtract' ]; mk.calc.dataObjectToArray = function(dataObject) { var dataArray = []; mk.calc.saveMappingKeys.forEach(function(key) { var value; if (dataObject.hasOwnProperty(key)) { value = dataObject[key]; } else { value = 0; } dataArray.push(value); }); return dataArray; }; mk.calc.dataArrayToObject = function(dataArray) { var dataObject = {}; mk.calc.saveMappingKeys.forEach(function(key, index) { if (dataArray[index] === undefined) { dataObject[key] = 0; } else { dataObject[key] = dataArray[index]; } }); return dataObject; }; var DataStorage = function(key) { this.key = key; this.load = function(isLoadSource) { var data = localStorage.getItem(this.key); data = (data && JSON.parse(data)) || []; if (isLoadSource) { return data; } data = data.map(function(dataArray) { return mk.calc.dataArrayToObject(dataArray); }); return data; }; this.save = function(dataObjects) { var dataArrays = dataObjects.map(function(dataObject) { return mk.calc.dataObjectToArray(dataObject); }); localStorage.setItem(this.key, JSON.stringify(dataArrays)); }; }; var createOption = function(el, value) { var option = document.createElement('option'); option.text = value; option.value = value; el.appendChild(option); }; var selectLastOption = function(el) { el.options[el.options.length - 1].selected = true; }; var BarracksContainer = function(data) { this.barracks = []; this.data = data; var i; for (i = 1; i <= this.data.count; i++) { var barrack = document.getElementById(this.data.prefix + '-levels-' + i); var j; var count; for (j = 0, count = this.data.maxLevel; j <= count; j++) { if (i === 1 && j === 0 && data.firstRequired) { continue; } createOption(barrack, j); } selectLastOption(barrack); this.barracks.push(barrack); } this.setDefaults = function() { this.barracks.forEach(function(el) { var saved = mk.calc.savedData.get(el.getAttribute('id')); if (saved !== undefined && saved !== null) { el.options[saved].selected = true; } }); }; this.updateSavedData = function() { this.barracks.forEach(function(el) { mk.calc.savedData.set(el.getAttribute('id'), el.selectedIndex); }); }; this.getMaxLevel = function() { return Math.max.apply(null, this.barracks.map(function(el) { return parseInt(el.value, 10); })); }; this.getAllNormalized = function() { return this.barracks.map(function(el) { return { 'level': parseInt(el.value, 10), 'queueLength': this.data.queue[el.value] }; }, this); }; this.getQueue = function() { return this.barracks.map(function(el) { return { 'num': el.getAttribute('id').slice(-1), 'time': 0, 'space': 0, 'maxSpace': this.data.queue[el.value], 'units': {}, 'level': parseInt(el.value, 10) }; }, this); }; this.getElements = function() { return this.barracks; }; this.getMaxCount = function() { return this.data.count; }; this.getCapLevel = function() { return this.data.maxLevel; }; this.getActiveCount = function() { return this.barracks.filter(function(b){ return b.value > 0; }).length; }; }; mk.calc.savedDataStorage = new DataStorage('data3'); mk.calc.savedDataAll = new mk.MultiDict(mk.calc.savedDataStorage.load()); mk.calc.savedData = mk.calc.savedDataAll.retrieve(0); mk.calc.allBarracks = {}; mk.objectIterate(mk.calc.barracksData, function(type, data) { mk.calc.allBarracks[type] = new BarracksContainer(data); }); mk.calc.armyCamps = document.getElementById('army-camps'); (function() { armyCampsData.base.forEach(createOption.bind(null, mk.calc.armyCamps)); var value; for (value = armyCampsData.base[armyCampsData.base.length - 1]; value <= armyCampsData.max; value += armyCampsData.step) { createOption(mk.calc.armyCamps, value); } selectLastOption(mk.calc.armyCamps); }()); mk.calc.spellFactoryLevel = document.getElementById('spell-factory-level'); (function() { var i; for (i = 0; i <= mk.calc.spellFactoryData.max; i++) { createOption(mk.calc.spellFactoryLevel, i); } selectLastOption(mk.calc.spellFactoryLevel); }()); }(window.mk)); (function(mk){ 'use strict'; var menuWrapperEl = document.querySelector('.js-menu-wrapper'); var menuEl = document.querySelector('.js-menu'); var menuTopPosition = mk.getTopPosition(menuEl); var menuElHeight = menuEl.offsetHeight; menuWrapperEl.style.height = menuElHeight + 'px'; var globalScrollOffset = 15; var isFixed = false; if (!mk.ios) { globalScrollOffset += menuElHeight; document.addEventListener('scroll', function() { if (window.pageYOffset >= menuTopPosition) { if (!isFixed) { menuEl.className += ' menu_fixed '; isFixed = true; } } else if (isFixed) { isFixed = false; menuEl.className = menuEl.className.replace(' menu_fixed ', ''); } }, false); } var smoothScroll = function(el) { var currentScrollTop = window.pageYOffset; var elScrollTop = mk.getTopPosition(el) - globalScrollOffset; var toTop = (elScrollTop < currentScrollTop); var diff = (toTop ? (currentScrollTop - elScrollTop) : (elScrollTop - currentScrollTop)); var duration = 100 + (diff / 20); var delay = 16; var step = Math.round(diff / (duration / delay)); var interval = setInterval(function() { if (toTop) { currentScrollTop -= step; if (currentScrollTop < elScrollTop) { currentScrollTop = elScrollTop; } } else { currentScrollTop += step; if (currentScrollTop > elScrollTop) { currentScrollTop = elScrollTop; } } window.scrollTo(window.pageXOffset, currentScrollTop); if (currentScrollTop === elScrollTop) { clearInterval(interval); } }, delay); }; mk.Events.listen('scrollTo', smoothScroll); var goToAnchor = function(e) { e.preventDefault(); e.stopPropagation(); smoothScroll(document.getElementById(e.currentTarget.getAttribute('data-anchor-target'))); }; mk.getAllByClass('js-anchor').forEach(function(el) { mk.addEvents(el, ['click', 'touchend'], goToAnchor); }); }(window.mk)); (function(mk){ 'use strict'; var typesSortedLevel = {}; mk.objectIterate(mk.calc.types, function(type, items) { typesSortedLevel[type] = []; mk.objectIterate(items, function(name, objects) { typesSortedLevel[type].unshift(objects.concat(name)); }); }); var currentSpace = { 'units': 0, 'dark': 0 }; var updateBarracksHeaders = function(type) { mk.calc.allBarracks[type].getAllNormalized().forEach(function(barrackData, barrackIndex) { var header; if (parseInt(barrackData.level, 10) === 0) { header = ''; } else { header = '<span class=\"data-secondary tooltip\" title=\"Maximum Queue Length\">(max ' + barrackData.queueLength + ')</span>'; } document.getElementById(type + '-barrack-header-' + (barrackIndex + 1)).innerHTML = header; }); }; var setQuantityAndSpace = function(maxSpace, totalSpace, type) { var spaceDiff = maxSpace - totalSpace; if (spaceDiff < 0) { spaceDiff = '<span class=\"limit-exceeded\">' + spaceDiff + '</span>'; } document.getElementById(type + '-quantity').innerHTML = '(' + spaceDiff + ' free)'; var space = totalSpace; if (totalSpace > maxSpace) { space = '<span class=\"limit-exceeded\">' + totalSpace + '</span>'; } space = space + ' / ' + (type === 'units' ? '': maxSpace); document.getElementById(type + '-space').innerHTML = space; }; var suitableBarracksSort = function(a, b) { // minimum time first if (a.time < b.time) { return -1; } if (a.time > b.time) { return 1; } // minimum space first if (a.space < b.space) { return -1; } if (a.space > b.space) { return 1; } // minimum max space first if (a.maxSpace < b.maxSpace) { return -1; } if (a.maxSpace > b.maxSpace) { return 1; } return 0; }; var barracksMinLevelSort = function(a, b) { // minimum level first if (a.level < b.level) { return -1; } if (a.level > b.level) { return 1; } return suitableBarracksSort(a, b); }; var getSuitableBarrack = function(barracks, requiredLevel, requiredSpace, requiredTime, avgTime) { var suitable = barracks.filter(function(barrack) { return barrack.level >= requiredLevel && (barrack.space + requiredSpace) <= barrack.maxSpace; }); if (!suitable.length) { return null; } if (suitable.length > 1) { if (requiredSpace === 1) { var timeSuitable = suitable.filter(function(barrack) { return (barrack.time + requiredTime) <= avgTime; }); if (timeSuitable.length) { if (timeSuitable.length > 1) { timeSuitable.sort(barracksMinLevelSort); } return timeSuitable[0]; } } suitable.sort(suitableBarracksSort); } return suitable[0]; }; var fillBarracks = function(barracksQueue, unitsDistribution, avgTime) { var stopDistribution = false; var udIndex; // ud - units distribution var udLength; for (udIndex = 0, udLength = unitsDistribution.length; udIndex < udLength; udIndex++) { var kit = unitsDistribution[udIndex]; var kitLevel = kit[2]; var kitTime = kit[3]; var kitSpace = kit[4]; var i; var barrack = null; for (i = 0; i < kit[1]; i++) { var isGetBarrack = true; if (barrack) { var newTime = barrack.time + kitTime; var newSpace = barrack.space + kitSpace; if (kitSpace === 1 && newTime <= avgTime && newSpace <= (barrack.maxSpace / 1.7)) { isGetBarrack = false; } } if (isGetBarrack) { barrack = getSuitableBarrack( barracksQueue, kitLevel, kitSpace, kitTime, avgTime ); } if (barrack === null) { stopDistribution = true; break; } if (barrack.units[kit[0]]) { barrack.units[kit[0]]++; } else { barrack.units[kit[0]] = 1; } barrack.time += kitTime; barrack.space += kitSpace; } } return !stopDistribution; }; var populateDistribution = function(fillSuccess, type, barracksQueue) { var bqIndex; var bqLength = barracksQueue.length; if (fillSuccess) { document.getElementById(type + '-barracks-exceeded').style.display = 'none'; var maxTime = 0; var maxNum = 1; for (bqIndex = 0; bqIndex < bqLength; bqIndex++) { var barrack = barracksQueue[bqIndex]; var unitIndex; for (unitIndex in barrack.units) { if (barrack.units[unitIndex] > 0) { document.getElementById( 'quantity-' + typesSortedLevel[type][unitIndex][4] + '-' + barrack.num ).textContent = '×' + barrack.units[unitIndex]; } } if (barrack.time > maxTime) { maxTime = barrack.time; maxNum = barrack.num; } document.getElementById( type + '-time-barrack-' + barrack.num ).textContent = (barrack.time ? mk.getFormattedTime(barrack.time) : ''); } var maxBarrack = document.getElementById(type + '-time-barrack-' + maxNum); maxBarrack.innerHTML = '<span class=\"result\">' + maxBarrack.textContent + '</span>'; } else { document.getElementById(type + '-barracks-exceeded').style.display = ''; for (bqIndex = 0; bqIndex < bqLength; bqIndex++) { document.getElementById(type + '-time-barrack-' + barracksQueue[bqIndex].num).textContent = ''; } } }; var calculateItems = function(type, params) { var clIndex; // cl - cap level for ( clIndex = params.capLevel; clIndex >= 1; clIndex-- ) { document.getElementById( type + '-building-level-' + clIndex ).style.display = (clIndex > params.levelValue ? 'none' : ''); } var totalCost = 0; var subtractedCost = 0; var totalSpace = 0; var totalTime = 0; var maxUnitTime = 0; var distribution = []; var tsIndex; // ts - types sorted var tsLength; for (tsIndex = 0, tsLength = typesSortedLevel[type].length; tsIndex < tsLength; tsIndex++) { var value = typesSortedLevel[type][tsIndex]; if (value[3] > params.levelValue) { continue; } var name = value[4]; var item = document.getElementById(name); var quantity = parseInt(item.value, 10) || 0; if (quantity < 0) { quantity = 0; } if (item.value !== '') { item.value = quantity; } var levelId = name + '-level'; var levelEl = document.getElementById(levelId); var summaryEl = document.getElementById(name + '-summary'); var costPerItem = levelEl.value; var summaryCost = (costPerItem * quantity); summaryEl.textContent = (summaryCost ? mk.numberFormat(summaryCost) : 0); totalCost += summaryCost; totalSpace += (value[2] * quantity); if (type === 'spells') { totalTime += (value[0] * quantity); } else { var mcIndex; // mc - max count for (mcIndex = 1; mcIndex <= mk.calc.allBarracks[type].getMaxCount(); mcIndex++) { document.getElementById('quantity-' + name + '-' + mcIndex).textContent = ''; } var subtractId = name + '-subtract'; var subtract = document.getElementById(subtractId); var subtractQuantity = parseInt(subtract.value, 10) || 0; if (subtractQuantity < 0) { subtractQuantity = 0; } if (subtract.value !== '') { subtract.value = subtractQuantity; } var totalQuantity = quantity - subtractQuantity; if (totalQuantity < 0) { totalQuantity = 0; } if (totalQuantity > 0) { distribution.push([ tsIndex, quantity - subtractQuantity, value[3], // level value[0], // time value[2] // space ]); maxUnitTime = Math.max(maxUnitTime, value[0]); totalTime += (value[0] * totalQuantity); } subtractedCost += (costPerItem * totalQuantity); mk.calc.savedData.set(subtractId, subtractQuantity); } mk.calc.savedData.set(name, quantity); mk.calc.savedData.set(levelId, levelEl.selectedIndex); } document.getElementById(type + '-cost').textContent = mk.numberFormat(totalCost); if (type === 'spells') { setQuantityAndSpace(params.space, totalSpace, type); if (totalTime > 0) { document.getElementById(type + '-time').textContent = mk.getFormattedTime(totalTime, true); } } else { var barracksQueue = mk.calc.allBarracks[type].getQueue(); var avgTime = Math.max(Math.ceil(totalTime / mk.calc.allBarracks[type].getActiveCount()), maxUnitTime); var fillSuccess = fillBarracks(barracksQueue, distribution, avgTime); populateDistribution(fillSuccess, type, barracksQueue); currentSpace[type] += totalSpace; var subtractedCostEl = document.getElementById(type + '-subtracted-cost'); if (subtractedCost === totalCost) { subtractedCostEl.textContent = ''; } else { subtractedCostEl.innerHTML = '− ' + mk.numberFormat(totalCost - subtractedCost) + ' = <span class=\"result\">' + mk.numberFormat(subtractedCost) + '</span>'; } } }; var calculate = function(type) { if (type === 'all' || type !== 'spells') { if (type === 'all' || type === 'barrack-units') { updateBarracksHeaders('units'); } if (type === 'all' || type === 'barrack-dark') { updateBarracksHeaders('dark'); } var armyCampsSpace = parseInt(mk.calc.armyCamps.value, 10); if (type === 'all' || type === 'units' || type === 'barrack-units') { currentSpace.units = 0; calculateItems('units', { 'levelValue': mk.calc.allBarracks.units.getMaxLevel(), 'capLevel': mk.calc.allBarracks.units.getCapLevel() }); } if (type === 'all' || type === 'dark' || type === 'barrack-dark') { currentSpace.dark = 0; calculateItems('dark', { 'levelValue': mk.calc.allBarracks.dark.getMaxLevel(), 'capLevel': mk.calc.allBarracks.dark.getCapLevel() }); } var togetherSpace = currentSpace.units + currentSpace.dark; setQuantityAndSpace(armyCampsSpace, togetherSpace, 'units'); setQuantityAndSpace(armyCampsSpace, togetherSpace, 'dark'); mk.calc.savedData.set('armyCamps', armyCampsSpace); mk.calc.allBarracks.units.updateSavedData(); mk.calc.allBarracks.dark.updateSavedData(); } if (type === 'all' || type === 'spells') { var spellFactoryLevel = parseInt(mk.calc.spellFactoryLevel.value, 10); calculateItems('spells', { 'levelValue': spellFactoryLevel, 'space': spellFactoryLevel, 'capLevel': mk.calc.spellFactoryData.max }); mk.calc.savedData.set('spellFactoryLevel', mk.calc.spellFactoryLevel.selectedIndex); } mk.calc.savedDataAll.update(0, mk.calc.savedData); mk.calc.savedDataStorage.save(mk.calc.savedDataAll.getAll()); mk.Events.trigger('calculated'); }; mk.Events.listen('calculate', calculate); }(window.mk)); (function(mk, Hogan){ 'use strict'; var barracksAnchor = document.getElementById('barracks-anchor'); var loadSaved = function(e) { e.preventDefault(); e.stopPropagation(); var dataToLoad = mk.objectCopy( mk.calc.savedDataAll.retrieve(e.currentTarget.getAttribute('data-num')).getAll() ); mk.calc.savedData = new mk.Dict(dataToLoad); mk.Events.trigger('setDefaults'); mk.Events.trigger('calculate', 'all'); mk.Events.trigger('loaded'); mk.Events.trigger('scrollTo', barracksAnchor); }; var savedListItemTemplate = new Hogan.Template(function(c,p,i){var _=this;_.b(i=i||\"\");_.b(\"<div class=\\\"saved-list__item\\\" id=\\\"saved-list-item-\");_.b(_.v(_.f(\"index\",c,p,0)));_.b(\"\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"hasCapacity\",c,p,1),c,p,0,82,194,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"        <div class=\\\"saved-list__item-result\\\">\");_.b(\"\\n\" + i);_.b(\"            \");_.b(_.v(_.f(\"totalCapacity\",c,p,0)));_.b(\" / \");_.b(_.v(_.f(\"armyCamps\",c,p,0)));_.b(\"\\n\" + i);_.b(\"        </div>\");_.b(\"\\n\");});c.pop();}_.b(\"\\n\" + i);if(_.s(_.f(\"units\",c,p,1),c,p,0,226,566,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"        <table class=\\\"saved-list__table\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"items\",c,p,1),c,p,0,291,442,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                <tr>\");_.b(\"\\n\" + i);_.b(\"                    <td class=\\\"number\\\">\");_.b(_.v(_.f(\"quantity\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                    <td>\");_.b(_.v(_.f(\"name\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                </tr>\");_.b(\"\\n\");});c.pop();}_.b(\"        </table>\");_.b(\"\\n\" + i);_.b(\"        <div class=\\\"saved-list__item-title\\\"><span class=\\\"cost-elixir\\\">\");_.b(_.v(_.f(\"cost\",c,p,0)));_.b(\"</span></div>\");_.b(\"\\n\");});c.pop();}_.b(\"\\n\" + i);if(_.s(_.f(\"dark\",c,p,1),c,p,0,591,936,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"        <table class=\\\"saved-list__table\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"items\",c,p,1),c,p,0,656,807,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                <tr>\");_.b(\"\\n\" + i);_.b(\"                    <td class=\\\"number\\\">\");_.b(_.v(_.f(\"quantity\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                    <td>\");_.b(_.v(_.f(\"name\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                </tr>\");_.b(\"\\n\");});c.pop();}_.b(\"        </table>\");_.b(\"\\n\" + i);_.b(\"        <div class=\\\"saved-list__item-title\\\"><span class=\\\"cost-dark-elixir\\\">\");_.b(_.v(_.f(\"cost\",c,p,0)));_.b(\"</span></div>\");_.b(\"\\n\");});c.pop();}_.b(\"\\n\" + i);if(_.s(_.f(\"hasSpells\",c,p,1),c,p,0,965,1428,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"        <div class=\\\"saved-list__item-result\\\">\");_.b(\"\\n\" + i);_.b(\"            \");_.b(_.v(_.f(\"spellsCapacity\",c,p,0)));_.b(\" / \");_.b(_.v(_.f(\"spellsFactoryLevel\",c,p,0)));_.b(\"\\n\" + i);_.b(\"        </div>\");_.b(\"\\n\" + i);_.b(\"        <table class=\\\"saved-list__table\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"spells\",c,p,1),c,p,0,1148,1299,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                <tr>\");_.b(\"\\n\" + i);_.b(\"                    <td class=\\\"number\\\">\");_.b(_.v(_.f(\"quantity\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                    <td>\");_.b(_.v(_.f(\"name\",c,p,0)));_.b(\"</td>\");_.b(\"\\n\" + i);_.b(\"                </tr>\");_.b(\"\\n\");});c.pop();}_.b(\"        </table>\");_.b(\"\\n\" + i);_.b(\"        <div class=\\\"saved-list__item-title\\\"><span class=\\\"cost-gold\\\">\");_.b(_.v(_.f(\"spellsCost\",c,p,0)));_.b(\"</span></div>\");_.b(\"\\n\");});c.pop();}_.b(\"\\n\" + i);_.b(\"    <div class=\\\"saved-list__actions\\\">\");_.b(\"\\n\" + i);_.b(\"        <span class=\\\"button js-saved-load\\\"\");_.b(\"\\n\" + i);_.b(\"              data-num=\\\"\");_.b(_.v(_.f(\"index\",c,p,0)));_.b(\"\\\"\");_.b(\"\\n\" + i);_.b(\"              tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexLoad\",c,p,0)));_.b(\"\\\"\");_.b(\"\\n\" + i);_.b(\"              title=\\\"Current composition will be lost\\\">\");_.b(\"\\n\" + i);_.b(\"            Load\");_.b(\"\\n\" + i);_.b(\"        </span>\");_.b(\"\\n\" + i);_.b(\"        <span class=\\\"button button_after js-saved-delete\\\"\");_.b(\"\\n\" + i);_.b(\"              data-num=\\\"\");_.b(_.v(_.f(\"index\",c,p,0)));_.b(\"\\\"\");_.b(\"\\n\" + i);_.b(\"              tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexDelete\",c,p,0)));_.b(\"\\\">\");_.b(\"\\n\" + i);_.b(\"            Delete\");_.b(\"\\n\" + i);_.b(\"        </span>\");_.b(\"\\n\" + i);_.b(\"    </div>\");_.b(\"\\n\" + i);_.b(\"</div>\");return _.fl();;}); var savedListCreateItems = function() { var content = []; mk.calc.savedDataAll.forEach(function(data, index) { if (index === 0) { return; } var templateVars = { 'index': index, 'tabIndexLoad': index + 3000 + 1, 'tabIndexDelete': index + 3000 + 2 }; var totalCapacity = 0; mk.objectIterate(mk.calc.barracksData, function(type, barracksData) { var items = []; var cost = 0; var levels = []; var i; for (i = 1; i < barracksData.count; i++) { levels.push(data.get(barracksData.prefix + '-levels-' + i, barracksData.maxLevel)); } mk.objectIterate(mk.calc.types[type], function(name, troopsData) { var quantity = parseInt(data.get(name), 10) || 0; var level = Math.max.apply(null, levels.map(function(barrackIndex, arrayIndex) { return (arrayIndex === 0 ? barrackIndex + 1 : barrackIndex); })); if (quantity > 0 && troopsData[3] <= level) { items.push({ 'name': mk.convertToTitle(name), 'quantity': quantity }); cost += troopsData[1][data.get(name + '-level')] * quantity; totalCapacity += troopsData[2] * quantity; } }); if (items.length) { templateVars[type] = { 'items': items, 'cost': mk.numberFormat(cost) }; } }); if (totalCapacity > 0) { templateVars.hasCapacity = { 'totalCapacity': totalCapacity, 'armyCamps': data.get('armyCamps') }; } if (data.get('spellFactoryLevel') > 0) { var spellsItems = []; var spellsCost = 0; var spellsCapacity = 0; var spellFactoryLevel = data.get('spellFactoryLevel'); mk.objectIterate(mk.calc.types.spells, function(spellName, spellValue) { var spellQuantity = parseInt(data.get(spellName), 10) || 0; if (spellQuantity > 0 && spellValue[3] <= spellFactoryLevel) { spellsItems.push({ 'name': mk.convertToTitle(spellName), 'quantity': spellQuantity }); spellsCost += spellValue[1][data.get(spellName + '-level')] * spellQuantity; spellsCapacity += spellValue[2] * spellQuantity; } }); if (spellsItems.length) { templateVars.hasSpells = { 'spells': spellsItems, 'spellsCost': mk.numberFormat(spellsCost), 'spellsCapacity': spellsCapacity, 'spellsFactoryLevel': spellFactoryLevel }; } } content.push(savedListItemTemplate.render(templateVars)); }); var savedListContent = document.getElementById('saved-list-content'); savedListContent.innerHTML = content.join(''); mk.getAllByClass('js-saved-load', savedListContent).forEach(function(el) { mk.addEvents(el, ['click', 'touchend'], loadSaved); }); var deleteSaved = function(e) { e.preventDefault(); e.stopPropagation(); mk.calc.savedDataAll.remove(e.currentTarget.getAttribute('data-num')); mk.calc.savedDataStorage.save(mk.calc.savedDataAll.getAll()); savedListCreateItems(); }; mk.getAllByClass('js-saved-delete', savedListContent).forEach(function(el) { mk.addEvents(el, ['click', 'touchend'], deleteSaved); }); }; var alreadySavedMessage = mk.infoMessage('already-saved', true); var savedCalculationAnchor = document.getElementById('saved-anchor'); var save = function(customParams) { var defaultParams = { 'showMessage': true }; var params = mk.objectExtend(defaultParams, customParams); alreadySavedMessage.hide(); var sourceData = mk.calc.savedDataStorage.load(true); if (sourceData[0]) { mk.calc.saveMappingKeys.forEach(function(key, index) { if (key.indexOf('subtract') !== -1) { sourceData[0][index] = 0; } }); var currentJSON = JSON.stringify(sourceData[0]); var sdIndex; var sdLength; for (sdIndex = 1, sdLength = sourceData.length; sdIndex < sdLength; sdIndex++) { var savedJSON = JSON.stringify(sourceData[sdIndex]); if (currentJSON === savedJSON) { if (params.showMessage) { alreadySavedMessage.show(); } return; } } var dataToSave = mk.objectCopy(mk.calc.savedData.getAll()); mk.calc.savedDataAll.insert(dataToSave); mk.calc.savedDataStorage.save(mk.calc.savedDataAll.getAll()); savedListCreateItems(); } }; mk.Events.listen('save', save); var saveHandler = function(e) { e.preventDefault(); e.stopPropagation(); if (e.currentTarget.getAttribute('data-scroll') === 'yes') { mk.Events.trigger('scrollTo', savedCalculationAnchor); } save(); }; mk.getAllByClass('js-save-composition').forEach(function(saveEl) { mk.addEvents(saveEl, ['click', 'touchend'], saveHandler); }); savedListCreateItems(); }(window.mk, window.Hogan)); (function(mk) { 'use strict'; var checkShare = function() { if (location.search.indexOf('?l=') !== -1) { var viewSharedMessage = mk.infoMessage('view-shared'); var urlData = location.search.substr(3); urlData = decodeURIComponent(urlData); mk.__globalSharedLink = urlData; urlData = urlData.replace(/[a-z]/g, ','); urlData = urlData.replace(/,(?=,)/g, ',0'); urlData = '[' + urlData + ']'; urlData = JSON.parse(urlData); urlData = mk.calc.dataArrayToObject(urlData); if (history.replaceState) { history.replaceState( {}, '', location.protocol + '//' + location.host + location.pathname ); } mk.Events.trigger('save', {'showMessage': false}); mk.calc.savedData = new mk.Dict(urlData); viewSharedMessage.show(); mk.Events.listen('loaded', function() { viewSharedMessage.hide(); }); } }; checkShare(); var shareTwitter = document.getElementById('share-twitter'); var shareFacebook = document.getElementById('share-facebook'); var permalink = document.getElementById('share-permalink'); permalink.addEventListener('click', mk.selectAll, false); var makePermalink = function() { var url = 'http://mkln.ru/clash-of-clans/?l='; var data = mk.calc.savedData.getAll(); data = mk.calc.dataObjectToArray(data); data = JSON.stringify(data); data = data.replace(/\\b(?:null|0)\\b/g, ''); data = data.substr(1, data.length - 2); data = data.replace(/,+$/, ''); // 97 - a, 122 - z var charCode = 97; data = data.replace(/,/g, function(match, p1) { var letter = String.fromCharCode(charCode); if (charCode === 122) { charCode = 97; } else { charCode++; } return letter; }); permalink.value = url + data; var shareUrl = encodeURIComponent(url + data); shareTwitter.setAttribute( 'href', 'https://twitter.com/share?url=' + shareUrl + '&via=ClashCalc&hashtags=ClashOfClans' ); shareFacebook.setAttribute( 'href', 'https://www.facebook.com/sharer/sharer.php?u=' + shareUrl ); }; var text = document.getElementById('share-text'); text.addEventListener('click', mk.selectAll, false); var superscriptNumbers = { '1': '¹', '2': '²', '3': '³', '4': '⁴', '5': '⁵', '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹' }; var currencies = { 'units': 'Elixir', 'dark': 'Dark Elixir', 'spells': 'Gold' }; var makeShareText = function() { var data = mk.calc.savedData.getAll(); var output = []; var prices = []; mk.objectIterate(mk.calc.types, function(type, items) { var maxLevel; if (type === 'spells') { maxLevel = parseInt(mk.calc.spellFactoryLevel.value, 10); } else { maxLevel = mk.calc.allBarracks[type].getMaxLevel(); } mk.objectIterate(items, function(itemName, itemData) { if (data[itemName] > 0 && itemData[3] <= maxLevel) { output.push( mk.convertToTitle(itemName) + superscriptNumbers[data[itemName + '-level'] + 1] + ' ×' + data[itemName] ); } }); var price = document.getElementById(type + '-cost').textContent; if (price !== '0') { prices.push(price + ' ' + currencies[type]); } }); if (output.length) { text.value = output.join(', ') + ' — ' + prices.join(', '); return true; } return false; }; var shareObjects = mk.getAllByClass('js-share'); var placeShareContent = function() { if (makeShareText()) { makePermalink(); shareObjects.forEach(function(el) { el.style.display = ''; }); } else { shareObjects.forEach(function(el) { el.style.display = 'none'; }); } }; mk.Events.listen('calculated', placeShareContent); }(window.mk)); (function(mk, Hogan) { 'use strict'; var setDefaults = function() { mk.calc.allBarracks.units.setDefaults(); mk.calc.allBarracks.dark.setDefaults(); var armyCampsSaved = mk.calc.savedData.get('armyCamps', mk.calc.armyCamps.value); var armyCampsOption = mk.calc.armyCamps.querySelector('option[value=\"' + armyCampsSaved + '\"]'); if (armyCampsOption) { armyCampsOption.selected = true; } var spellFactoryIndex = mk.calc.savedData.get('spellFactoryLevel', mk.calc.spellFactoryLevel.selectedIndex); mk.calc.spellFactoryLevel.options[spellFactoryIndex].selected = true; var setItems = function(type) { mk.objectIterate(mk.calc.types[type], function(name) { var levelId = name + '-level'; var levelEl = document.getElementById(levelId); levelEl.options[mk.calc.savedData.get(levelId, levelEl.selectedIndex)].selected = true; var valueEl = document.getElementById(name); if (type === 'spells') { valueEl.options[mk.calc.savedData.get(name, valueEl.selectedIndex)].selected = true; } else { valueEl.value = mk.calc.savedData.get(name) || 0; var subtractId = name + '-subtract'; document.getElementById(subtractId).value = mk.calc.savedData.get(subtractId) || 0; } }); }; setItems('units'); setItems('spells'); setItems('dark'); }; mk.Events.listen('setDefaults', setDefaults); mk.objectIterate(mk.calc.allBarracks, function(k, v) { v.getElements().forEach(function(el) { el.addEventListener('change', function() { mk.Events.trigger('calculate', 'barrack-' + k); }, false); }); }); mk.calc.armyCamps.addEventListener('change', function() { mk.Events.trigger('calculate', 'all'); }, false); mk.calc.spellFactoryLevel.addEventListener('change', function() { mk.Events.trigger('calculate', 'spells'); }, false); var rowTemplate = new Hogan.Template(function(c,p,i){var _=this;_.b(i=i||\"\");_.b(\"    <tr id=\\\"\");_.b(_.v(_.f(\"rowId\",c,p,0)));_.b(\"\\\">\");_.b(\"\\n\" + i);_.b(\"        <td>\");_.b(\"\\n\" + i);_.b(\"            <a href=\\\"\");_.b(_.v(_.f(\"titleLink\",c,p,0)));_.b(\"\\\" class=\\\"wikia-link\\\" target=\\\"_blank\\\">\");_.b(_.v(_.f(\"title\",c,p,0)));_.b(\"</a>\");_.b(\"\\n\" + i);_.b(\"        </td>\");_.b(\"\\n\" + i);_.b(\"        <td>\");_.b(\"\\n\" + i);_.b(\"            <select id=\\\"\");_.b(_.v(_.f(\"levelId\",c,p,0)));_.b(\"\\\" tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexLevel\",c,p,0)));_.b(\"\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"levelContent\",c,p,1),c,p,0,249,330,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                    <option value=\\\"\");_.b(_.v(_.f(\"value\",c,p,0)));_.b(\"\\\">\");_.b(_.v(_.f(\"text\",c,p,0)));_.b(\"</option>\");_.b(\"\\n\");});c.pop();}_.b(\"            </select>\");_.b(\"\\n\" + i);_.b(\"        </td>\");_.b(\"\\n\" + i);_.b(\"        <td>\");_.b(\"\\n\" + i);if(_.s(_.f(\"spells\",c,p,1),c,p,0,420,686,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                <select id=\\\"\");_.b(_.v(_.f(\"id\",c,p,0)));_.b(\"\\\" tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexValue\",c,p,0)));_.b(\"\\\" data-field-type=\\\"quantity\\\">\");_.b(\"\\n\" + i);if(_.s(_.f(\"options\",c,p,1),c,p,0,546,635,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"                        <option value=\\\"\");_.b(_.v(_.f(\"value\",c,p,0)));_.b(\"\\\">\");_.b(_.v(_.f(\"text\",c,p,0)));_.b(\"</option>\");_.b(\"\\n\");});c.pop();}_.b(\"                </select>\");_.b(\"\\n\");});c.pop();}if(!_.s(_.f(\"spells\",c,p,1),c,p,1,0,0,\"\")){_.b(\"                <input type=\\\"text\\\" pattern=\\\"[0-9]*\\\" data-object-type=\\\"\");_.b(_.v(_.f(\"objectType\",c,p,0)));_.b(\"\\\" min=\\\"0\\\" max=\\\"999\\\" class=\\\"js-number\\\" id=\\\"\");_.b(_.v(_.f(\"id\",c,p,0)));_.b(\"\\\" size=\\\"3\\\" tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexValue\",c,p,0)));_.b(\"\\\" data-field-type=\\\"quantity\\\"/>\");_.b(\"\\n\");};_.b(\"        </td>\");_.b(\"\\n\" + i);_.b(\"        <td id=\\\"\");_.b(_.v(_.f(\"summaryId\",c,p,0)));_.b(\"\\\" class=\\\"number\\\">\");_.b(\"\\n\" + i);_.b(\"        </td>\");_.b(\"\\n\" + i);if(_.s(_.f(\"subtractId\",c,p,1),c,p,0,1045,1300,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"            <td>\");_.b(\"\\n\" + i);_.b(\"               <input type=\\\"text\\\" pattern=\\\"[0-9]*\\\" data-object-type=\\\"\");_.b(_.v(_.f(\"objectType\",c,p,0)));_.b(\"\\\" min=\\\"0\\\" max=\\\"999\\\" class=\\\"js-number\\\" id=\\\"\");_.b(_.v(_.f(\"subtractId\",c,p,0)));_.b(\"\\\" size=\\\"3\\\" tabindex=\\\"\");_.b(_.v(_.f(\"tabIndexSubtract\",c,p,0)));_.b(\"\\\" data-field-type=\\\"subtract\\\"/>\");_.b(\"\\n\" + i);_.b(\"            </td>\");_.b(\"\\n\");});c.pop();}if(_.s(_.f(\"barracksTimes\",c,p,1),c,p,0,1342,1415,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"            <td id=\\\"\");_.b(_.v(_.f(\"barrackQuantityId\",c,p,0)));_.b(\"\\\" class=\\\"number\\\"></td>\");_.b(\"\\n\");});c.pop();}if(_.s(_.f(\"spells\",c,p,1),c,p,0,1453,1484,\"{{ }}\")){_.rs(c,p,function(c,p,_){_.b(\"            <td></td>\");_.b(\"\\n\");});c.pop();}_.b(\"    </tr>\");return _.fl();;}); var createRows = function(type, tabIndexMultiplier) { var createLevelOption = function(value, index) { return {'value': value, 'text': (index + 1)}; }; var spellsValuesContent = []; if (type === 'spells') { var i; for (i = 0; i <= mk.calc.spellFactoryData.max; i++) { spellsValuesContent.push({'value': i, 'text': i}); } } var itemsBody = document.getElementById(type + '-body'); mk.objectIterate(mk.calc.types[type], function(name, value) { var convertedName = mk.convertToTitle(name); var templateVars = { 'id': name, 'title': convertedName, 'titleLink': 'http://clashofclans.wikia.com/wiki/' + (convertedName + (type === 'spells' ? '_Spell' : '')).replace(' ', '_'), 'levelId': name + '-level', 'levelContent': value[1].map(createLevelOption), 'summaryId': name + '-summary', 'rowId': type + '-building-level-' + value[3], 'tabIndexLevel': tabIndexMultiplier + value[3], 'tabIndexValue': tabIndexMultiplier + 1000 + value[3], 'objectType': type }; if (type === 'spells') { templateVars.spells = { 'options': spellsValuesContent }; } if (type === 'units' || type === 'dark') { var i; var barracksTimes = []; for (i = 1; i <= mk.calc.allBarracks[type].getMaxCount(); i++) { barracksTimes.push({ 'barrackQuantityId': 'quantity-' + name + '-' + i }); } templateVars.barracksTimes = barracksTimes; templateVars.subtractId = name + '-subtract'; templateVars.tabIndexSubtract = tabIndexMultiplier + 4000 + value[3]; } var rowHTML = rowTemplate.render(templateVars); var tempDiv = document.createElement('div'); tempDiv.innerHTML = '<table>' + rowHTML + '</table>'; var itemRow = tempDiv.querySelector('tr'); itemsBody.appendChild(itemRow); document.getElementById(templateVars.levelId).addEventListener( 'change', function() { mk.Events.trigger('calculate', type); }, false ); document.getElementById(templateVars.id).addEventListener( (type === 'spells' ? 'change' : 'input'), function() { mk.Events.trigger('calculate', type); }, false ); if (type === 'units' || type === 'dark') { document.getElementById(templateVars.subtractId).addEventListener( 'input', function() { mk.Events.trigger('calculate', type); }, false ); } }); }; createRows('units', 100); createRows('dark', 200); createRows('spells', 300); setDefaults(); mk.Events.trigger('calculate', 'all'); }(window.mk, window.Hogan)); (function(mk){ 'use strict'; var spinnerAction = function(targetElement, type) { var current = parseInt(targetElement.value, 10); if (type === '+') { if (isNaN(current)) { targetElement.value = 1; } else { targetElement.value = current + 1; } } else { if (isNaN(current) || current < 2) { targetElement.value = 0; } else { targetElement.value = current - 1; } } mk.Events.trigger('calculate', targetElement.getAttribute('data-object-type')); }; var spinnerInterval = null; var spinnerTimeout = null; var spinnerHold = function(e) { e.preventDefault(); e.stopPropagation(); e.currentTarget.spinnerClicked = true; spinnerTimeout = setTimeout(function(eventElement) { eventElement.spinnerClicked = false; (function fakeInterval() { spinnerInterval = setTimeout(function() { spinnerAction(eventElement.spinnerTarget, eventElement.textContent); fakeInterval(); }, 100); }()); }.bind(null, e.currentTarget), 500); }; var spinnerRelease = function(e) { e.preventDefault(); e.stopPropagation(); if (e.currentTarget.spinnerClicked) { spinnerAction(e.currentTarget.spinnerTarget, e.currentTarget.textContent); } clearTimeout(spinnerTimeout); clearInterval(spinnerInterval); }; var setSpinner = function(type, el) { var span = document.createElement('span'); span.className = 'button button_after button_middle'; span.textContent = (type === 'plus' ? '+' : '−'); span.spinnerTarget = el; mk.addEvents(span, ['touchstart', 'mousedown'], spinnerHold); mk.addEvents(span, ['touchend', 'mouseup'], spinnerRelease); if (el.nextSibling) { el.parentNode.insertBefore(span, el.nextSibling); } else { el.parentNode.appendChild(span); } }; var spinnerKeyboard = function(e) { var code = e.keyCode || e.which; if (code === 38) { spinnerAction(e.currentTarget, '+'); e.preventDefault(); } else if (code === 40) { spinnerAction(e.currentTarget, '-'); e.preventDefault(); } }; mk.getAllByClass('js-number').forEach(function(el) { el.addEventListener('focus', mk.selectAll, false); setSpinner('minus', el); setSpinner('plus', el); el.addEventListener('keydown', spinnerKeyboard, false); }); }(window.mk)); (function(mk){ 'use strict'; var resetColumn = function(e) { e.preventDefault(); e.stopPropagation(); var resetType = e.currentTarget.getAttribute('data-reset-type'); var scope = e.currentTarget.getAttribute('data-scope'); mk.getAll('input[data-field-type=\"' + scope + '\"][data-object-type=\"' + resetType + '\"]').forEach(function(el) { el.value = '0'; }); mk.Events.trigger('calculate', resetType); }; mk.getAllByClass('js-reset').forEach(function(el) { mk.addEvents(el, ['click', 'touchend'], resetColumn); }); }(window.mk)); </script> <script>!function(e){\"use strict\";window.device&&window.device.cordova&&e.toArray(document.getElementsByTagName(\"a\")).forEach(function(e){var t=e.getAttribute(\"href\");e.removeAttribute(\"target\"),e.setAttribute(\"href\",\"javascript:void(0)\"),e.addEventListener(\"touchend\",function(e){e.preventDefault(),e.stopPropagation(),app.open_browser(t)})})}(window.mk);</script> </body> </html> ","version":1377012316462},"changelog":{"1376510400000":["Added menu for easier navigation"]}},"error":0}